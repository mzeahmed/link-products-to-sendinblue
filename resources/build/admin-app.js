(()=>{"use strict";const e={init:function(){const e=document.querySelector("#lpts_user_attributes_fields"),t=document.getElementById("userAttributesAdd"),n=document.getElementById("userAttributesDel");e&&e.childElementCount<2&&(n.disabled=!0),t&&t.addEventListener("click",(()=>{this._addFields(e,n)})),n&&n.addEventListener("click",(()=>{this._removeFields(e,n)}))},_addFields:function(e,t){const n=document.querySelector(".attributes_match_row");if(!n)return;const o=n.cloneNode(!0);e.appendChild(o),t.disabled=!1},_removeFields:function(e,t){if(e.childElementCount<2)return;const n=e.lastElementChild;n&&e.removeChild(n),e.childElementCount<2&&(t.disabled=!0)}},t=window.wp.i18n,n={init:function(){const e=document.getElementById("sendinblue_data_panel");console.log("%c[productPanel] Init called","color: limegreen");const t=document.getElementById("add_lpts_list_row"),n=document.getElementById("lpts_list_rows");if(!t||!n||!e)return;let o=[],l={};try{o=JSON.parse(e.dataset.lists||"{}"),l=JSON.parse(e.dataset.roles||"{}")}catch(e){return void console.error("Invalid JSON in data-lists:",e)}this._addList(t,n,o,l),this._removeList(n)},_addList:function(e,n,o,l){e.addEventListener("click",(()=>{const e=n.querySelectorAll("tr").length,l=document.createElement("tr"),i=Object.entries(o).map((([e,t])=>`<option value="${e}">${t}</option>`)).join("");l.innerHTML=`\n        <td class="list-cell">\n          <select name="_selec_list[${e}][list_id]" class="wc-enhanced-select lpts-list">\n            ${i}\n          </select>\n        </td>\n\n        <td class="condition-cell">\n          <select name="_selec_list[${e}][condition]" class="lpts-condition">\n            <option value="always">${(0,t.__)("Always","link-products-to-sendinblue")}</option>\n            <option value="product_price_gte">${(0,t.__)("Product Price >=","link-products-to-sendinblue")}</option>\n            <option value="product_price_eq">${(0,t.__)("Product Price =","link-products-to-sendinblue")}</option>\n            <option value="product_price_lt">${(0,t.__)("Product Price <","link-products-to-sendinblue")}</option>\n            \x3c!-- <option value="user_role">${(0,t.__)("User Role","link-products-to-sendinblue")}</option> --\x3e\n          </select>\n        </td>\n\n        <td class="param-cell">\n          <input type="text" name="_selec_list[${e}][param]" />\n        </td>\n\n        <td><button type="button" class="button remove-row">${(0,t.__)("Remove","link-products-to-sendinblue")}</button></td>\n      `,n.appendChild(l)}))},_removeList:function(e){e.addEventListener("click",(e=>{const t=e.target;if(t.classList.contains("remove-row")){const e=t.closest("tr");e&&e.remove()}}))},_onUserRoleSelect:function(e){console.log("%c[_onUserRoleSelect] Registered","color: orange"),Object.entries(e).map((([e,t])=>`<option value="${e}">${t}</option>`)).join("");const t=document.querySelectorAll(".lpts-condition");console.log("conditionSelect:",t),t.forEach(((t,n)=>{const o=t.parentElement?.parentElement,l=o.querySelector(".param-cell");t.addEventListener("change",(o=>{const i=t.value;if(console.log("value:",i,o),"user_role"===i){const t=document.createElement("select");t.name=`_selec_list[${n}][param]`,Object.entries(e).forEach((([e,n])=>{const o=document.createElement("option");o.value=e,o.textContent=n,t.appendChild(o)})),l.innerHTML="",l.appendChild(t)}else l.innerHTML=`<input type="text" name="_selec_list[${n}][param]" />`}))}))}};document.addEventListener("DOMContentLoaded",(()=>{e.init(),n.init()}))})();